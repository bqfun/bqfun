<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <id>https://bqfun.jp/blog</id>
    <title>BQ FUN Blog</title>
    <updated>2023-04-13T00:00:00.000Z</updated>
    <generator>https://github.com/jpmonette/feed</generator>
    <link rel="alternate" href="https://bqfun.jp/blog"/>
    <subtitle>BQ FUN Blog</subtitle>
    <icon>https://bqfun.jp/img/favicon.ico</icon>
    <entry>
        <title type="html"><![CDATA[アドレス・ベース・レジストリ 住所、所在地情報を加工して Analytics Hub - Google Cloud で公開]]></title>
        <id>base-registry-address-preprocessed</id>
        <link href="https://bqfun.jp/blog/base-registry-address-preprocessed"/>
        <updated>2023-04-13T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[アドレス・ベース・レジストリ（デジタル庁）の、住所、所在地情報を閲覧できる BigQuery テーブルを作成し、Analytics Hub にて公開しました。]]></summary>
        <content type="html"><![CDATA[<p>アドレス・ベース・レジストリ（デジタル庁）の、住所、所在地情報を閲覧できる BigQuery テーブルを作成し、Analytics Hub にて公開しました。</p><p>USマルチリージョン、asia-northeast1リージョン向けにそれぞれ公開しています。</p><ul><li><a href="https://console.cloud.google.com/bigquery/analytics-hub/exchanges(analyticshub:projects/jpdata/locations/us/dataExchanges/us_jpdata_1877561be8d/listings/base_registry_address_preprocessed_by_bq_fun_123456789ab)" target="_blank" rel="noopener noreferrer">US</a></li><li><a href="https://console.cloud.google.com/bigquery/analytics-hub/exchanges(analyticshub:projects/jpdata/locations/asia-northeast1/dataExchanges/jpdata_18253a34a30/listings/base_registry_address_preprocessed_by_bq_fun_123456789ab)" target="_blank" rel="noopener noreferrer">asia-northeast1</a></li></ul><p>Analytics Hub を通して、自身の所有する Google Cloud プロジェクトの、BigQuery データセットとしてリンクできます。
他にもいくつかのデータを公開しており、<a href="https://bqfun.jp/docs/jpdata" target="_blank" rel="noopener noreferrer">https://bqfun.jp/docs/jpdata</a> から確認できます。</p><p><img loading="lazy" src="/assets/images/img-28451c7b0712419aab48cd23dce823fe.png" width="929" height="491" class="img_ev3q"></p><p>このデータは「アドレス・ベース・レジストリ」（デジタル庁）（<a href="https://www.digital.go.jp/policies/base_registry_address/" target="_blank" rel="noopener noreferrer">https://www.digital.go.jp/policies/base_registry_address/</a> ）を加工して作成しています。
このデータは都道府県、市区町村、町字単位のマスターデータとしての利用を想定されており、手元のデータの整理や集計を助けてくれるはずです。</p><p><img loading="lazy" alt="img_1.png" src="/assets/images/img_1-952c8ea1980f5acaa785e5a32fea5fe3.png" width="1189" height="564" class="img_ev3q"></p><p>このプロジェクトでは、オープンデータをオープンプロセスで加工して提供することを目標としており、 コードは <a href="https://github.com/bqfun/jpdata/blob/dc28e7b25cd71c41d89ca8d36a046ab00094ea05/terraform/modules/base_registry_address/main.tf" target="_blank" rel="noopener noreferrer">GitHub</a> から確認できます。
コードは概ね次のように加工プロセスを定義し、内部では Cloud Scheduler、Cloud Workflows、Cloud Run、Cloud Storage、BigQuery が使われています。</p><div class="language-terraform codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-terraform codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">module "main" {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  source         = "../../modules/workflows_http_to_bigquery_datasets"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name           = "base_registry_address"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  tweakle_cpu    = "0.08"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  tweakle_memory = "512Mi"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  etlt = [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      name = "pref"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      extraction = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        url = "https://catalog.registries.digital.go.jp/rsc/address/mt_pref_all.csv.zip"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      tweaks = [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          call = "unzip"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      transformation = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        fields = [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          "local_government_code",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          "prefecture",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          "prefecture_kana",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          "prefecture_en",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          "effective_from",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          "effective_to",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          "remarks",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        query = &lt;&lt;-EOF</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        CREATE OR REPLACE TABLE $${table}(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          local_government_code STRING OPTIONS(description="全国地方公共団体コード"),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          prefecture STRING OPTIONS(description="都道府県名"),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          prefecture_kana STRING OPTIONS(description="都道府県名_カナ"),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          prefecture_en STRING OPTIONS(description="都道府県名_英字"),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          effective_from DATE OPTIONS(description="効力発生日"),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          effective_to DATE OPTIONS(description="廃止日"),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          remarks STRING OPTIONS(description="備考"),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        OPTIONS(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          description="https://catalog.registries.digital.go.jp/rsc/address/mt_pref_all.csv.zip",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          friendly_name="日本 都道府県マスター データセット",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          labels=[</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            ("freshness", "daily")</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          ]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        AS</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        SELECT</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          local_government_code,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          prefecture,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          prefecture_kana,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          prefecture_en,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          PARSE_DATE("%Y-%m-%d", effective_from) AS effective_from,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          PARSE_DATE("%Y-%m-%d", effective_to) AS effective_to,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          remarks,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        FROM</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          $${staging}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        EOF</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>注意書き</p><p>BQ FUNは、利用者が本コンテンツを用いて行う一切の責任を負いません。 また、予告なく変更、削除される場合があります。</p><p>出典：「アドレス・ベース・レジストリ」（デジタル庁）（<a href="https://www.digital.go.jp/policies/base_registry_address/" target="_blank" rel="noopener noreferrer">https://www.digital.go.jp/policies/base_registry_address/</a> ）</p>]]></content>
        <author>
            <name>Naofumi Yamada</name>
            <uri>https://github.com/na0fu3y</uri>
        </author>
        <category label="analyticshub" term="analyticshub"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[gBizINFO 法人情報を加工して Analytics Hub - Google Cloud で公開]]></title>
        <id>gbizinfo-preprocessed</id>
        <link href="https://bqfun.jp/blog/gbizinfo-preprocessed"/>
        <updated>2022-08-01T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[gBizINFOの、法人番号のついた組織について情報を閲覧できるBigQueryテーブルを作成し、gBizINFO preprocessed by BQ FUN - Analytics Hubで公開しました。]]></summary>
        <content type="html"><![CDATA[<p>gBizINFOの、法人番号のついた組織について情報を閲覧できるBigQueryテーブルを作成し、<a href="https://console.cloud.google.com/bigquery/analytics-hub/exchanges/projects/120299025068/locations/asia-northeast1/dataExchanges/jpdata_18253a34a30/listings/gbizinfo_preprocessed_by_bq_fun_18253b3389d" target="_blank" rel="noopener noreferrer">gBizINFO preprocessed by BQ FUN - Analytics Hub</a>で公開しました。
Analytics Hubを通して、自身の所有するGoogle Cloudプロジェクトの、BigQueryデータセットとしてリンクできます。</p><p><img loading="lazy" src="/assets/images/gbizinfo-1a47975018b16efdfcff48dc4dbd6126.png" width="768" height="391" class="img_ev3q"></p><p>「gBizINFO」（経済産業省）（<a href="https://info.gbiz.go.jp/hojin/DownloadTop" target="_blank" rel="noopener noreferrer">https://info.gbiz.go.jp/hojin/DownloadTop</a> ）を加工して作成しています。
CSVダウンロードデータであり、gBizINFOで公開されている最新情報を閲覧できます。</p><p>Google Cloud上で、Scheduler、Workflows、Functionsを使って、更新されます。
Terraformコードは<a href="https://github.com/bqfun/jpdata/blob/42d140912feb5a8f4244d6e7cd6c4e479a871c2a/terraform/environments/prod/main.tf#L6-L17" target="_blank" rel="noopener noreferrer">こちら</a>から確認できます。</p><p>BQ FUNは、利用者が本コンテンツを用いて行う一切の責任を負いません。 また、予告なく変更、削除される場合があります。</p><p>出典：「gBizINFO」（経済産業省）（<a href="https://info.gbiz.go.jp/" target="_blank" rel="noopener noreferrer">https://info.gbiz.go.jp/</a> ）</p>]]></content>
        <author>
            <name>Naofumi Yamada</name>
            <uri>https://github.com/na0fu3y</uri>
        </author>
        <category label="analyticshub" term="analyticshub"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[祝日情報を加工して Analytics Hub - Google Cloud で公開]]></title>
        <id>holidays-preprocessed</id>
        <link href="https://bqfun.jp/blog/holidays-preprocessed"/>
        <updated>2022-07-31T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[国民の祝日を閲覧できるBigQueryテーブルを作成し、JP Holidays preprocessed by BQ FUN - Analytics Hubで公開しました。]]></summary>
        <content type="html"><![CDATA[<p>国民の祝日を閲覧できるBigQueryテーブルを作成し、<a href="https://console.cloud.google.com/bigquery/analytics-hub/exchanges/projects/120299025068/locations/asia-northeast1/dataExchanges/jpdata_18253a34a30/listings/jp_holidays_preprocessed_by_bq_fun_18253c4e9dc" target="_blank" rel="noopener noreferrer">JP Holidays preprocessed by BQ FUN - Analytics Hub</a>で公開しました。
自身の所有するGoogle Cloudプロジェクトの、BigQueryデータセットとしてリンクできます。</p><p><img loading="lazy" src="/assets/images/jpholidays-6c90dbd8b0a6d03e824eeb011fa82f56.png" width="773" height="633" class="img_ev3q"></p><p>「国民の祝日について」（内閣府）（<a href="https://www8.cao.go.jp/chosei/shukujitsu/gaiyou.html" target="_blank" rel="noopener noreferrer">https://www8.cao.go.jp/chosei/shukujitsu/gaiyou.html</a> ）を加工して作成しています。</p><p>Google Cloud上で、Scheduler、Workflows、Functionsを使って、更新されます。
Terraformコードは<a href="https://github.com/bqfun/jpdata/blob/42d140912feb5a8f4244d6e7cd6c4e479a871c2a/terraform/environments/prod/main.tf#L19-L30" target="_blank" rel="noopener noreferrer">こちら</a>から確認できます。</p><p>BQ FUNは、利用者が本コンテンツを用いて行う一切の責任を負いません。 また、予告なく変更、削除される場合があります。</p><p>出典：「国民の祝日について」（内閣府）（<a href="https://www8.cao.go.jp/chosei/shukujitsu/gaiyou.html" target="_blank" rel="noopener noreferrer">https://www8.cao.go.jp/chosei/shukujitsu/gaiyou.html</a> ）</p>]]></content>
        <author>
            <name>Naofumi Yamada</name>
            <uri>https://github.com/na0fu3y</uri>
        </author>
        <category label="analyticshub" term="analyticshub"/>
    </entry>
</feed>